---
title: "HW01"
format: html
---

## Research Question

**Which kinds of Brazilian companies hold the most capital stock (and is it concentrated in a few categories)?**

## Background and Data Story

Brazil’s CNPJ registry includes information about companies’ legal structure (legal nature), company size, and declared share capital (capital stock, in BRL). Capital stock is usually very skewed, meaning a small number of firms or categories can hold a huge share of total capital. In this short data story, I use the cleaned TidyTuesday dataset (filtered to companies above a capital-stock threshold) to compare **total capital** across groups and see where capital appears most concentrated. The visualization summarizes both the *overall scale* (total capital) and the *distribution* (how uneven it is within each group), helping us see which categories dominate and whether that dominance comes from many firms or a small “top tail.”

```{r}
library(tidyverse)
library(scales)

# Load data (TidyTuesday 2026-01-27)
companies <- readr::read_csv(
  "https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2026/2026-01-27/companies.csv",
  show_col_types = FALSE
)

# Clean + keep what we need
plot_data <- companies %>%
  filter(!is.na(company_size), !is.na(capital_stock), capital_stock > 0) %>%
  mutate(
    company_size = str_to_title(company_size),
    company_size = fct_relevel(company_size, "Micro-Enterprise", "Small-Enterprise", after = 0)
  )

# Summarize total capital by size (top-to-bottom)
sum_size <- plot_data %>%
  group_by(company_size) %>%
  summarise(
    n = n(),
    total_capital = sum(capital_stock, na.rm = TRUE),
    median_capital = median(capital_stock, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(desc(total_capital)) %>%
  mutate(company_size = fct_reorder(company_size, total_capital))

# Pastel palette
pastel <- c(
  "#B6CDE3", "#E9A6A6", "#CDE7D8", "#E6D6F2", "#F6E7B2",
  "#D4F0F0", "#F9D5E5", "#E8D7C5"
)
pal <- setNames(pastel[seq_len(nlevels(sum_size$company_size))], levels(sum_size$company_size))

# Plot: Total capital by company size (pastel bars) + labels
ggplot(sum_size, aes(x = company_size, y = total_capital, fill = company_size)) +
  geom_col(width = 0.62, alpha = 0.85) +
  geom_text(
    aes(label = comma(total_capital / 1e9, accuracy = 0.1)),
    vjust = -0.4,
    size = 4,
    fontface = "bold"
  ) +
  scale_fill_manual(values = pal) +
  scale_y_continuous(
    labels = function(x) paste0(comma(x / 1e9), "B"),
    expand = expansion(mult = c(0, 0.12))
  ) +
  labs(
    title = "Which company sizes hold the most capital stock in Brazil?",
    subtitle = "Total declared capital stock (BRL), summed within each company-size group",
    x = NULL,
    y = "Total capital stock (BRL, billions)",
    caption = "Source: Brazil CNPJ (Receita Federal) • TidyTuesday 2026-01-27"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 18),
    plot.subtitle = element_text(color = "grey40", size = 12),
    axis.text.x = element_text(color = "grey30"),
    axis.text.y = element_text(color = "grey30"),
    panel.grid.minor = element_blank()
  )

```

